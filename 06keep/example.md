# Keep

Keep files, stop DCE

Check the [code folder](https://github.com/MatthijsKamstra/haxeunity/tree/master/06keep/code) for more comments.


The short version of the folder structure will not work without the files Unity needs.
If you want to know more about that, read the [setup](../00setup/example.md)

```
+ unity-haxe-helloworld
	+ Assets
	+ Source
		+ view
			- HideWhenPlaying.hx
		- Main.hx
	- build.hxml
```



## The Main.hx

So we need a class/Script that you can use to hide a gameobject when its playing in Unity. Maybe its a placeholder or design layout asset.

We start with a simple `Main.hx` class. But we will not directly call the class/function

```haxe
package;

import unityengine.*;
// make sure this class is transpiled into C#/cs
import view.HideWhenPlaying;

@:nativeGen
class Main extends MonoBehaviour {

	function Awake() {
		Debug.Log('[Haxe] Main Awake()');
	}
}
```


As you might have noticed we import `view.HideWhePlaying`.

So lets make that Class

First I will show the original file I created in C#

```cs
using UnityEngine;

public class HideWhenPlaying : MonoBehaviour
{
    void Awake(){
        gameObject.SetActive(false);
    }
}
```


```haxe
package view;

import unityengine.MonoBehaviour;

@:nativeGen
@:keep
class HideWhenPlaying extends MonoBehaviour {
	function Awake() {
		gameObject.SetActive(false);
	}
}
```


Very simular. In my original C# file I didn't use a package (or namespace) but .. he I wanted to improve on my previous project.

In the Main calls we use a direct import (`import view.*` will not work). And because of `@:keep` the DCE will not clean this file.

The generated C# file is not as clean as the original file:

```cs
// Generated by Haxe 3.4.7

#pragma warning disable 109, 114, 219, 429, 168, 162
namespace view {
	public class HideWhenPlaying : global::UnityEngine.MonoBehaviour {

		public HideWhenPlaying() : base() { }

		public virtual void Awake() {
			( this as global::UnityEngine.Component ).gameObject.SetActive(((bool) (false) ));
		}
	}
}
```

But still very readable for C# developers



## The Haxe build file, build.hxml update

I will be using the "unity-haxe-helloworld" from Nadako in all examples. But this also means that you need to change something first before you can build.

```bash
-cp Source
-D net-ver=40
# -net-lib C:\Program Files (x86)\Unity\Editor\Data\Managed\UnityEngine.dll
# -net-lib /Applications/Unity/Unity.app/Contents/Managed/UnityEngine.dll
-net-lib /Applications/Unity/Hub/Editor/2018.3.12f1/Unity.app/Contents/Managed/UnityEngine.dll
-cs Assets/Code
-D no-compilation
-D real-position
Main
```

If you work on Windows you should have a path the unity engine:

`-net-lib C:\Program Files (x86)\Unity\Editor\Data\Managed\UnityEngine.dll`

If you work on Osx you should have a path the unity engine:

`-net-lib /Applications/Unity/Unity.app/Contents/Managed/UnityEngine.dll`

I work on osx and I used "Unity Hub" to install Unity my path was:

`-net-lib /Applications/Unity/Hub/Editor/2018.3.12f1/Unity.app/Contents/Managed/UnityEngine.dll`

The only thing I added to the build.hxml is

```
-D real-position
```

This stops the generate `#line` directives that map C# expression positions to original .hx files. Useful for tracking down issues related to code generation. But I hope I will never need this. So lets not generate this lines.



## The Main.hx

Open your favorite editor, copy/paste the code and save it in the `Source` folder.

```haxe
package;

import unityengine.*;

@:nativeGen
class Main extends MonoBehaviour {

	function Awake() {
		// logging via unity
		Debug.Log('[Unity] Hello world');
	}
}

```


